<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="replyMapper">

	<resultMap type="Reply" id="replyMap">
		<result property="id" 				column="id" 			jdbcType="INTEGER" />
		<result property="originId" 		column="article_id" 	jdbcType="INTEGER" />
		<result property="targetType" 		column="target_type" 	jdbcType="INTEGER" />
		<result property="targetId" 		column="target_id"		jdbcType="INTEGER" />
		<result property="content" 			column="depth" 			jdbcType="INTEGER" />
		<result property="userId"			column="users_id"		jdbcType="INTEGER" />
		<result property="userNickname" 	column="nickname" 		jdbcType="VARCHAR" />
		<result property="registrationTime" column="register_time" 	jdbcType="TIMESTAMP" />
		<result property="isActive" 		column="is_active" 		jdbcType="CHAR" />
		<result property="like" 			column="like" 			jdbcType="INTEGER" />
		<result property="disLike" 			column="dislike" 		jdbcType="INTEGER" />
	</resultMap>
	
	<insert id="addReply" parameterType="Reply">
	<selectKey keyProperty="id" resultType="int" order="BEFORE"> 
	SELECT NEXTVAL('reply_id_seq')
	</selectKey>
	INSERT INTO
		reply
		(id, article_id, users_id
		, content, register_time, modify_time
		, is_active
		,target_type, target_id, depth)
		VALUES
		(#{id}, #{originId}, #{userId}
		, #{content}, NOW(), NOW()
		, 'A'
		, #{targetType}, #{targetId}, #{depth} )
	
	</insert>
	
	<select id="getReplyList">
	SELECT
		content,register_time
	FROM
		reply
	WHERE
		article_id = #{originId}
	
	</select>

</mapper>